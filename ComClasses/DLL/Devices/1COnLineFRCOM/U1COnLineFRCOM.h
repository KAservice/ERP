//---------------------------------------------------------------------------

#ifndef U1COnLineFRCOMH
#define U1COnLineFRCOMH
//---------------------------------------------------------------------------


#include <vcl.h>
#include "GlobalInterface.h"
#include "IMainComInterface.h"
#include "IObject1CVnCompCOM.h"

class T1COnLineFRCOM
		{
private:


UnicodeString DopStrL(UnicodeString Str, UnicodeString Symbol, int Len);
UnicodeString DopStrR(UnicodeString Str, UnicodeString Symbol, int Len);
void OpenDrawer(void);
int CompareDoubleValue(double v1, double v2, int pogr);

		bool PrintFiscalCheckSale(double sum,
														int department,
														double oplata_nal,
														double oplata_bank_card,
														double oplata_plat_card,
														double oplata_credit_card,
														int operation);    //0 продажа 1 возврат

		bool PrintFiscalCheckReturnSale(double sum,
														int department,
														double oplata_nal,
														double oplata_bank_card,
														double oplata_plat_card,
														double oplata_credit_card,
														int operation);    //0 продажа 1 возврат


		int KolSymbolSize1;
		int KolSymbolSize1Girn;
		int KolSymbolSize2;
		int KolSymbolSize2Girn;
		int KolSymbolSize3;
		int KolSymbolSize3Girn;
		int KolSymbolSize4;
		int KolSymbolSize4Girn;

		void InitKasVariant(TkasVariant * kv);

		UnicodeString IDDevice;
		bool GetError(void);

		TStringList * kasListDocumentPackage;
		TStringList * kasListCheckPackage;
		TStringList * kasListGoodsPackage;

		UnicodeString FormatForXML(UnicodeString str);
        UnicodeString ReplaceCommaToPixel(UnicodeString str);
		UnicodeString ConverIntegerTaxToString(int tax);

		int LineLength;

		int flTypeDocument;
 public:
		T1COnLineFRCOM();
		~T1COnLineFRCOM();

		IkanCom *InterfaceGlobalCom;
		IkanUnknown * InterfaceMainObject;
		IkanUnknown * InterfaceOwnerObject;
		IkanUnknown * InterfaceImpl; //интерфейс класса реализации
		GUID ClsIdImpl;				 //GUID класса реализации

		IObject1CVnCompCOM * ObjectVC;


bool NoPrint;
bool UseJournalRibbon;
bool UseReceiptRibbon;
bool OpenNoFiscalDoc;


		int Number;
		AnsiString Modul;
		UnicodeString Name;
		bool Error;
		int CodeError;
		UnicodeString TextError;
		UnicodeString TextErrorNoConnect;
		bool ConnectFR;

		int Init();
		int Done();


		bool Connect(int number_port,
						UnicodeString baud_rate,
						UnicodeString password);

		bool Disconnect(void);

		bool GetSostKKM(void);
		bool ProvVosmPrintCheck(void);


		bool PrintString(UnicodeString str,
                                int size_font,       //1234
                                int girn,            //1-жирный 0 обычный
                                int alignment,      //0 лево 1 центр 2 право
                                bool ch_lenta,       //на чековой ленте
								bool kontr_lenta,   //на контрольной ленте
								bool word_wrap);


        bool PrintFiscalCheck(double sum,
                                int department,
                                double oplata_nal,
								double oplata_bank_card,
								double oplata_plat_card,
								double oplata_credit_card,
								int operation);    //0 продажа 1 возврат







		bool PrintNoFiscalCheck(double sum,
                                int department,
								double oplata_nal,
								double oplata_bank_card,
								double oplata_plat_card,
								double oplata_credit_card,
                                int operation);    //0 продажа 1 возврат

        bool PrintXReport(void);
        bool PrintZReport(void);
        bool PrintPoOtdelamReport(void);

        bool Cut(int TypeCut);
		bool Vnesenie(double sum);
        bool Snatie(double sum);

        bool PrintLine(void);

        bool OpenNoFiscalCheck(void);
        bool CloseNoFiscalCheck(void);


        //параметры ККМ и чека
                int NumberCheck;
                int NumberKL;
				UnicodeString SerialNumberKKM;
				UnicodeString RegNumberKKM;
				UnicodeString ModelKKM;

		//время и дата
		TTime GetTime(void);
		TDate GetDate(void);
		bool SetTime(TTime time);
		bool SetDate(TDate date);






   //новые функции для работы с он-лайн кассами
   bool OpenShift(void);
   bool CloseShift(void);
   bool InitDocument(int type_doc);
   bool CreateHeaderFiscalCheck(void);
   bool CreateFooterFiscalCheck(void);
   bool AddFiscalString(void);



//параметры чека  //заголовок 	Parameters
// Обязательно long Тип расчета
//1 - Приход
//2 - Возврат прихода
//3 - Расход
//4 - Возврат расхода
//Формирование нового чека с заданным атрибутами.

	int PaymentType;


//При формирование чека ККТ должен проверять, что передаваемый код системы налогообложения доступен для данного фискализированного ФН.
/// TaxVariant Обязательно long Код системы налогообложения. Коды системы налогообложения приведены в таблице "Системы налогообложения".
//Системы налогообложения
//Код Описание
//0  Общая
//1  Упрощенная Доход
//2  Упрощенная Доход минус Расход
//3  Единый налог на вмененный доход
//4  Единый сельскохозяйственный налог
//5  Патентная система налогообложения

	int TaxVariant;

//CustomerEmail Необязательно string Email покупателя
	UnicodeString CustomerEmail;

//CustomerPhone Необязательно string Телефонный номер покупателя
	UnicodeString CustomerPhone;

//AgentCompensation Необязательно double Размер вознаграждения агента
	double AgentCompensation;

//AgentPhone Необязательно string Контактный телефон агента
	UnicodeString AgentPhone;

//SubagentPhone Необязательно string Телефон платежного субагента
	UnicodeString SubagentPhone;

//ReceivePaymentsOperatorPhone  Необязательно string Телефон оператора по приему платежей
	UnicodeString ReceivePaymentsOperatorPhone;

//MoneyTransferOperatorPhone  Необязательно string Телефон оператора по переводу денежных средств
	UnicodeString MoneyTransferOperatorPhone;

//BankAgentPhone  Необязательно string Телефон банковского агента
	UnicodeString BankAgentPhone;

//BankSubagentPhone  Необязательно string Телефон банковского субагента
	UnicodeString BankSubagentPhone;

//BankAgentOperation Необязательно string Операция банковского агента
	UnicodeString BankAgentOperation;


//BankSubagentOperation Необязательно string Операция банковского субагента
	UnicodeString BankSubagentOperation;

//BankAgentCompensation  Необязательно double Размер вознаграждения банковского агента (субагента)
	double BankAgentCompensation ;


//MoneyTransferOperatorName Необязательно string Наименование оператора по переводу денежных средств
	UnicodeString MoneyTransferOperatorName ;


//MoneyTransferOperatorAddress  Необязательно string Адрес оператора по переводу денежных средств
	UnicodeString MoneyTransferOperatorAddress ;

//MoneyTransferOperatorVATIN  Необязательно string ИНН оператора по переводу денежных
	UnicodeString MoneyTransferOperatorVATIN ;

 //ФОРМИРОВАНИЕ ТАБЛИЦЫ ЧЕКА
 //позиции чека, тип строки       1-фиск строка 2- текстовая строка 3-штрих код
	int TypeFiscalString;

	//FiscalString  Регистрирует фискальную строку с переданными реквизитами.
	//Name Да string  Наименование товара
	//При печати длинных фискальных строк необходимо делать перенос на следующую строку.
	UnicodeString NameNom;

	 //Quantity Да double Количество товара
	double Quantity;

	//Price Да double Цена единицы товара без учета скидок/наценок
	double Price;

	//Amount Да double Конечная сумма по позиции чека (с учетом всех скидок/наценок)
	double Amount;

	//Department Нет long Отдел, по которому ведется продажа
	int Department;

	//Tax Да string Ставка НДС. Список значений:
					  //	"18" - НДС 18
					  //	"10" - НДС 10
					  //	"0" - НДС 0
					  //	"none" - БЕЗ НДС


						//case 0:    //не задан
						//case 1:    //без ндс
						//case 2:    //0%
						//case 3:    //10%
						//case 4:    //18%
	int Tax;


	//TextString  Печать текстовой строки.
	//Text Да string Строка с произвольным текстом
	UnicodeString TextString;

	//Barcode   Печать штрихкода. Осуществляется с автоматическим размером с выравниванием по центру чека.
	//BarcodeType Да string Строка, определяющая тип штрихкода

	UnicodeString BarcodeType ;
	//Тип штрихкода может иметь одно из следующих значений: EAN8, EAN13, CODE39, QR. В случае, если модель устройства не поддерживает печать штрихкода, выдается ошибка.

	UnicodeString Barcode;

 //Payments  Параметры закрытия чека. Сумма всех видов оплат должна быть больше суммы открытого чека.


//Cash Нет decimal Сумма наличной оплаты Параметры закрытия чека. Сумма всех видов оплат должна быть больше суммы открытого чека.
	double Cash;

//CashLessType1 Нет decimal Сумма электронной оплаты первого типа
	double CashLessType1;

//CashLessType2 Нет decimal Сумма электронной оплаты второго типа
	double CashLessType2;

//CashLessType3 Нет decimal Сумма электронной оплаты третьего типа
	double CashLessType3 ;



	UnicodeString GetParameters(void);
	bool SetParameter(UnicodeString name_parameter, UnicodeString value_parameter);


   UnicodeString GetAdditionalActions(void);
   bool DoAdditionalAction(UnicodeString name_action);



   //	Кассир (CashierName) STRING [IN] ФИО уполномоченного лица для проведения операции
UnicodeString CashierName;
//	Электронно (Electronically) BOOL (IN) Формирование чека в только электроном виде. Печать чека не осуществляется.
bool Electronically;
//	ФискальныйПризнак (FiscalSign) STRING [OUT] Фискальный признак
UnicodeString FiscalSign;
//	AddressSiteInspections (АдресСайтаПроверки) STRING [OUT] Адрес сайта проверки
UnicodeString AddressSiteInspections;


UnicodeString GetMetodsList(void);


bool GetParameter(UnicodeString name_parameter, TkasVariant * value_parameter);
bool SetParameter(UnicodeString name_parameter, TkasVariant * value_parameter);

		};
#endif
